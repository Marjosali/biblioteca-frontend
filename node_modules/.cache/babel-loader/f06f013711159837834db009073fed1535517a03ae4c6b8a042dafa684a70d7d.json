{"ast":null,"code":"// src/services/auth.js\n\nconst API_URL = \"http://127.0.0.1:8000/api/\";\n\n/* ========================================================\r\n   üîπ LOGIN ‚Äî Faz autentica√ß√£o JWT e salva tokens no localStorage\r\n   ======================================================== */\nexport async function login(username, password) {\n  try {\n    const response = await fetch(`${API_URL}token/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username,\n        password\n      })\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      const msg = errorData.detail || errorData.message || \"Usu√°rio ou senha inv√°lidos.\";\n      throw new Error(msg);\n    }\n    const data = await response.json();\n\n    // ‚úÖ Salva tokens no localStorage\n    localStorage.setItem(\"access_token\", data.access);\n    localStorage.setItem(\"refresh_token\", data.refresh);\n    return data;\n  } catch (error) {\n    console.error(\"‚ùå Falha no login:\", error);\n    throw error;\n  }\n}\n\n/* ========================================================\r\n   üîπ REFRESH TOKEN ‚Äî Atualiza o token de acesso\r\n   ======================================================== */\nexport async function refreshAccessToken() {\n  const refresh = localStorage.getItem(\"refresh_token\");\n  if (!refresh) return null;\n  try {\n    const response = await fetch(`${API_URL}token/refresh/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        refresh\n      })\n    });\n    if (!response.ok) {\n      console.warn(\"‚ö†Ô∏è Falha ao renovar token ‚Äî sess√£o expirada.\");\n      logout();\n      return null;\n    }\n    const data = await response.json();\n    if (data.access) {\n      localStorage.setItem(\"access_token\", data.access);\n      return data.access;\n    }\n    return null;\n  } catch (error) {\n    console.error(\"‚ùå Erro ao atualizar token:\", error);\n    logout();\n    return null;\n  }\n}\n\n/* ========================================================\r\n   üîπ HEADERS ‚Äî Retorna cabe√ßalhos com token JWT\r\n   ======================================================== */\nexport function getAuthHeaders() {\n  const token = localStorage.getItem(\"access_token\");\n  return token ? {\n    Authorization: `Bearer ${token}`,\n    \"Content-Type\": \"application/json\"\n  } : {\n    \"Content-Type\": \"application/json\"\n  };\n}\n\n/* ========================================================\r\n   üîπ USER INFO ‚Äî Decodifica o token e retorna dados do usu√°rio\r\n   ======================================================== */\nexport function getUserInfo() {\n  const token = localStorage.getItem(\"access_token\");\n  if (!token) return null;\n  try {\n    const payload = JSON.parse(atob(token.split(\".\")[1]));\n    return {\n      user_id: payload.user_id,\n      username: payload.username,\n      is_staff: payload.is_staff || false,\n      is_superuser: payload.is_superuser || false,\n      exp: payload.exp\n    };\n  } catch (error) {\n    console.error(\"‚ùå Erro ao decodificar token:\", error);\n    return null;\n  }\n}\n\n/* ========================================================\r\n   üîπ STATUS ‚Äî Verifica se o token ainda √© v√°lido\r\n   ======================================================== */\nexport function isAuthenticated() {\n  const token = localStorage.getItem(\"access_token\");\n  if (!token) return false;\n  try {\n    const {\n      exp\n    } = JSON.parse(atob(token.split(\".\")[1]));\n    return Date.now() < exp * 1000;\n  } catch {\n    return false;\n  }\n}\n\n/* ========================================================\r\n   üîπ LOGOUT ‚Äî Limpa a sess√£o do usu√°rio\r\n   ======================================================== */\nexport function logout() {\n  localStorage.removeItem(\"access_token\");\n  localStorage.removeItem(\"refresh_token\");\n}","map":{"version":3,"names":["API_URL","login","username","password","response","fetch","method","headers","body","JSON","stringify","ok","errorData","json","catch","msg","detail","message","Error","data","localStorage","setItem","access","refresh","error","console","refreshAccessToken","getItem","warn","logout","getAuthHeaders","token","Authorization","getUserInfo","payload","parse","atob","split","user_id","is_staff","is_superuser","exp","isAuthenticated","Date","now","removeItem"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/biblioteca/frontend/src/services/auth.js"],"sourcesContent":["// src/services/auth.js\r\n\r\nconst API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\n/* ========================================================\r\n   üîπ LOGIN ‚Äî Faz autentica√ß√£o JWT e salva tokens no localStorage\r\n   ======================================================== */\r\nexport async function login(username, password) {\r\n  try {\r\n    const response = await fetch(`${API_URL}token/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ username, password }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      const msg =\r\n        errorData.detail || errorData.message || \"Usu√°rio ou senha inv√°lidos.\";\r\n      throw new Error(msg);\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    // ‚úÖ Salva tokens no localStorage\r\n    localStorage.setItem(\"access_token\", data.access);\r\n    localStorage.setItem(\"refresh_token\", data.refresh);\r\n\r\n    return data;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Falha no login:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ REFRESH TOKEN ‚Äî Atualiza o token de acesso\r\n   ======================================================== */\r\nexport async function refreshAccessToken() {\r\n  const refresh = localStorage.getItem(\"refresh_token\");\r\n  if (!refresh) return null;\r\n\r\n  try {\r\n    const response = await fetch(`${API_URL}token/refresh/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ refresh }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      console.warn(\"‚ö†Ô∏è Falha ao renovar token ‚Äî sess√£o expirada.\");\r\n      logout();\r\n      return null;\r\n    }\r\n\r\n    const data = await response.json();\r\n    if (data.access) {\r\n      localStorage.setItem(\"access_token\", data.access);\r\n      return data.access;\r\n    }\r\n\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao atualizar token:\", error);\r\n    logout();\r\n    return null;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ HEADERS ‚Äî Retorna cabe√ßalhos com token JWT\r\n   ======================================================== */\r\nexport function getAuthHeaders() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  return token\r\n    ? {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"application/json\",\r\n      }\r\n    : { \"Content-Type\": \"application/json\" };\r\n}\r\n\r\n/* ========================================================\r\n   üîπ USER INFO ‚Äî Decodifica o token e retorna dados do usu√°rio\r\n   ======================================================== */\r\nexport function getUserInfo() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  if (!token) return null;\r\n\r\n  try {\r\n    const payload = JSON.parse(atob(token.split(\".\")[1]));\r\n    return {\r\n      user_id: payload.user_id,\r\n      username: payload.username,\r\n      is_staff: payload.is_staff || false,\r\n      is_superuser: payload.is_superuser || false,\r\n      exp: payload.exp,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao decodificar token:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ STATUS ‚Äî Verifica se o token ainda √© v√°lido\r\n   ======================================================== */\r\nexport function isAuthenticated() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  if (!token) return false;\r\n\r\n  try {\r\n    const { exp } = JSON.parse(atob(token.split(\".\")[1]));\r\n    return Date.now() < exp * 1000;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ LOGOUT ‚Äî Limpa a sess√£o do usu√°rio\r\n   ======================================================== */\r\nexport function logout() {\r\n  localStorage.removeItem(\"access_token\");\r\n  localStorage.removeItem(\"refresh_token\");\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}