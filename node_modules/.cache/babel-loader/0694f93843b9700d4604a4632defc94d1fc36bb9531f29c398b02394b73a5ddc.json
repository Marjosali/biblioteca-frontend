{"ast":null,"code":"const API_URL = \"http://127.0.0.1:8000/api/\";\n\n/**\r\n * Retorna headers com token JWT\r\n */\nexport function getAuthHeaders() {\n  const token = localStorage.getItem(\"access_token\");\n  return token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n}\n\n/**\r\n * Login do usuário\r\n */\nexport async function login(username, password) {\n  const response = await fetch(`${API_URL}token/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) throw new Error(\"Erro ao fazer login\");\n  const data = await response.json();\n  localStorage.setItem(\"access_token\", data.access);\n  localStorage.setItem(\"refresh_token\", data.refresh);\n  return data;\n}\n\n/**\r\n * Logout\r\n */\nexport function logout() {\n  localStorage.removeItem(\"access_token\");\n  localStorage.removeItem(\"refresh_token\");\n}\n\n/**\r\n * Atualiza token\r\n */\nexport async function refreshAccessToken() {\n  const refresh = localStorage.getItem(\"refresh_token\");\n  if (!refresh) return null;\n  try {\n    const res = await fetch(`${API_URL}token/refresh/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        refresh\n      })\n    });\n    if (!res.ok) throw new Error(\"Erro ao atualizar token\");\n    const data = await res.json();\n    localStorage.setItem(\"access_token\", data.access);\n    return data.access;\n  } catch {\n    logout();\n    return null;\n  }\n}\n\n/**\r\n * Busca livros\r\n */\nexport async function getBooks() {\n  try {\n    const res = await fetch(`${API_URL}books/`, {\n      headers: getAuthHeaders()\n    });\n    if (res.status === 401) {\n      const token = await refreshAccessToken();\n      if (token) return getBooks();\n    }\n    if (!res.ok) throw new Error(\"Erro ao buscar livros\");\n    return await res.json();\n  } catch (error) {\n    console.error(\"❌ Falha ao buscar livros:\", error);\n    return [];\n  }\n}\n\n/**\r\n * Cria ou atualiza livro\r\n */\nexport async function saveBook(book) {\n  try {\n    const formData = new FormData();\n    Object.keys(book).forEach(key => {\n      if (book[key] !== undefined && book[key] !== null) {\n        formData.append(key, book[key]);\n      }\n    });\n    const isEdit = Boolean(book.id);\n    const url = `${API_URL}books/${isEdit ? `${book.id}/` : \"\"}`;\n    const res = await fetch(url, {\n      method: isEdit ? \"PUT\" : \"POST\",\n      headers: getAuthHeaders(),\n      // ⚡ apenas Authorization, sem Content-Type\n      body: formData\n    });\n    if (res.status === 401) {\n      const token = await refreshAccessToken();\n      if (token) return saveBook(book);\n    }\n    if (!res.ok) throw new Error(\"Erro ao salvar livro\");\n    return await res.json();\n  } catch (error) {\n    console.error(\"❌ Falha ao salvar livro:\", error);\n    throw error;\n  }\n}\n\n/**\r\n * Deleta livro\r\n */\nexport async function deleteBook(id) {\n  try {\n    const res = await fetch(`${API_URL}books/${id}/`, {\n      method: \"DELETE\",\n      headers: getAuthHeaders()\n    });\n    if (res.status === 401) {\n      const token = await refreshAccessToken();\n      if (token) return deleteBook(id);\n    }\n    if (!res.ok) throw new Error(\"Erro ao deletar livro\");\n    return true;\n  } catch (error) {\n    console.error(\"❌ Falha ao deletar livro:\", error);\n    return false;\n  }\n}","map":{"version":3,"names":["API_URL","getAuthHeaders","token","localStorage","getItem","Authorization","login","username","password","response","fetch","method","headers","body","JSON","stringify","ok","Error","data","json","setItem","access","refresh","logout","removeItem","refreshAccessToken","res","getBooks","status","error","console","saveBook","book","formData","FormData","Object","keys","forEach","key","undefined","append","isEdit","Boolean","id","url","deleteBook"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/biblioteca/frontend/src/Api.js"],"sourcesContent":["const API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\n/**\r\n * Retorna headers com token JWT\r\n */\r\nexport function getAuthHeaders() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\n/**\r\n * Login do usuário\r\n */\r\nexport async function login(username, password) {\r\n  const response = await fetch(`${API_URL}token/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n  if (!response.ok) throw new Error(\"Erro ao fazer login\");\r\n  const data = await response.json();\r\n  localStorage.setItem(\"access_token\", data.access);\r\n  localStorage.setItem(\"refresh_token\", data.refresh);\r\n  return data;\r\n}\r\n\r\n/**\r\n * Logout\r\n */\r\nexport function logout() {\r\n  localStorage.removeItem(\"access_token\");\r\n  localStorage.removeItem(\"refresh_token\");\r\n}\r\n\r\n/**\r\n * Atualiza token\r\n */\r\nexport async function refreshAccessToken() {\r\n  const refresh = localStorage.getItem(\"refresh_token\");\r\n  if (!refresh) return null;\r\n\r\n  try {\r\n    const res = await fetch(`${API_URL}token/refresh/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ refresh }),\r\n    });\r\n    if (!res.ok) throw new Error(\"Erro ao atualizar token\");\r\n    const data = await res.json();\r\n    localStorage.setItem(\"access_token\", data.access);\r\n    return data.access;\r\n  } catch {\r\n    logout();\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Busca livros\r\n */\r\nexport async function getBooks() {\r\n  try {\r\n    const res = await fetch(`${API_URL}books/`, { headers: getAuthHeaders() });\r\n    if (res.status === 401) {\r\n      const token = await refreshAccessToken();\r\n      if (token) return getBooks();\r\n    }\r\n    if (!res.ok) throw new Error(\"Erro ao buscar livros\");\r\n    return await res.json();\r\n  } catch (error) {\r\n    console.error(\"❌ Falha ao buscar livros:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\n/**\r\n * Cria ou atualiza livro\r\n */\r\nexport async function saveBook(book) {\r\n  try {\r\n    const formData = new FormData();\r\n    Object.keys(book).forEach((key) => {\r\n      if (book[key] !== undefined && book[key] !== null) {\r\n        formData.append(key, book[key]);\r\n      }\r\n    });\r\n\r\n    const isEdit = Boolean(book.id);\r\n    const url = `${API_URL}books/${isEdit ? `${book.id}/` : \"\"}`;\r\n    const res = await fetch(url, {\r\n      method: isEdit ? \"PUT\" : \"POST\",\r\n      headers: getAuthHeaders(), // ⚡ apenas Authorization, sem Content-Type\r\n      body: formData,\r\n    });\r\n\r\n    if (res.status === 401) {\r\n      const token = await refreshAccessToken();\r\n      if (token) return saveBook(book);\r\n    }\r\n\r\n    if (!res.ok) throw new Error(\"Erro ao salvar livro\");\r\n    return await res.json();\r\n  } catch (error) {\r\n    console.error(\"❌ Falha ao salvar livro:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Deleta livro\r\n */\r\nexport async function deleteBook(id) {\r\n  try {\r\n    const res = await fetch(`${API_URL}books/${id}/`, {\r\n      method: \"DELETE\",\r\n      headers: getAuthHeaders(),\r\n    });\r\n\r\n    if (res.status === 401) {\r\n      const token = await refreshAccessToken();\r\n      if (token) return deleteBook(id);\r\n    }\r\n\r\n    if (!res.ok) throw new Error(\"Erro ao deletar livro\");\r\n    return true;\r\n  } catch (error) {\r\n    console.error(\"❌ Falha ao deletar livro:\", error);\r\n    return false;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}