{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\MARCIOJOSEDOSSANTOS\\\\Desktop\\\\biblioteca\\\\frontend\\\\src\\\\components\\\\LoanButton.js\",\n  _s = $RefreshSig$();\n// src/components/LoanButton.js\nimport React, { useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport axios from \"axios\";\nimport { refreshToken, logout } from \"../services/api\"; // Corrigido: refreshToken\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function LoanButton({\n  bookId,\n  refreshBooks,\n  disabled\n}) {\n  _s();\n  const [loading, setLoading] = useState(false);\n  const requestLoan = async () => {\n    let token = localStorage.getItem(\"access_token\");\n    if (!token) {\n      alert(\"‚ö†Ô∏è Voc√™ precisa estar logado para solicitar um empr√©stimo!\");\n      return;\n    }\n    setLoading(true);\n    try {\n      const response = await axios.post(\"http://127.0.0.1:8000/api/loans/\", {\n        book: bookId\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      if (response.status === 201) {\n        alert(\"‚úÖ Empr√©stimo solicitado com sucesso!\");\n        refreshBooks();\n      } else {\n        var _response$data;\n        alert(\"‚ö†Ô∏è Erro ao solicitar empr√©stimo: \" + (((_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.detail) || \"N√£o foi poss√≠vel completar a opera√ß√£o.\"));\n      }\n    } catch (error) {\n      var _error$response;\n      console.error(\"Erro ao solicitar empr√©stimo:\", error);\n\n      // Se 401, tentar refresh do token\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n        const newToken = await refreshToken(); // Corrigido aqui\n        if (newToken) {\n          return requestLoan(); // tenta novamente\n        } else {\n          logout();\n          alert(\"‚ö†Ô∏è Sess√£o expirada. Fa√ßa login novamente.\");\n        }\n      } else {\n        var _error$response2, _error$response2$data, _error$response3, _error$response3$data;\n        const detail = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.detail) || ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || error.message;\n        alert(\"‚ùå Erro ao solicitar empr√©stimo: \" + detail);\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: requestLoan,\n    disabled: loading || disabled,\n    \"aria-label\": \"Solicitar empr\\xE9stimo de livro\",\n    className: `loan-btn ${loading ? \"loading\" : \"\"}`,\n    style: {\n      padding: \"0.5rem 1rem\",\n      borderRadius: \"6px\",\n      border: \"none\",\n      cursor: loading || disabled ? \"not-allowed\" : \"pointer\",\n      backgroundColor: loading || disabled ? \"#999\" : \"#007bff\",\n      color: \"#fff\",\n      fontWeight: \"bold\",\n      transition: \"background 0.3s\"\n    },\n    children: loading ? \"üîÑ Solicitando...\" : \"üìñ Solicitar Empr√©stimo\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 5\n  }, this);\n}\n_s(LoanButton, \"/Rjh5rPqCCqf0XYnTUk9ZNavw3Q=\");\n_c = LoanButton;\nLoanButton.propTypes = {\n  bookId: PropTypes.number.isRequired,\n  refreshBooks: PropTypes.func.isRequired,\n  disabled: PropTypes.bool\n};\nLoanButton.defaultProps = {\n  disabled: false\n};\nvar _c;\n$RefreshReg$(_c, \"LoanButton\");","map":{"version":3,"names":["React","useState","PropTypes","axios","refreshToken","logout","jsxDEV","_jsxDEV","LoanButton","bookId","refreshBooks","disabled","_s","loading","setLoading","requestLoan","token","localStorage","getItem","alert","response","post","book","headers","Authorization","status","_response$data","data","detail","error","_error$response","console","newToken","_error$response2","_error$response2$data","_error$response3","_error$response3$data","message","onClick","className","style","padding","borderRadius","border","cursor","backgroundColor","color","fontWeight","transition","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","propTypes","number","isRequired","func","bool","defaultProps","$RefreshReg$"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/biblioteca/frontend/src/components/LoanButton.js"],"sourcesContent":["// src/components/LoanButton.js\r\nimport React, { useState } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport axios from \"axios\";\r\nimport { refreshToken, logout } from \"../services/api\"; // Corrigido: refreshToken\r\n\r\nexport default function LoanButton({ bookId, refreshBooks, disabled }) {\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const requestLoan = async () => {\r\n    let token = localStorage.getItem(\"access_token\");\r\n    if (!token) {\r\n      alert(\"‚ö†Ô∏è Voc√™ precisa estar logado para solicitar um empr√©stimo!\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      const response = await axios.post(\r\n        \"http://127.0.0.1:8000/api/loans/\",\r\n        { book: bookId },\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n            \"Content-Type\": \"application/json\",\r\n          },\r\n        }\r\n      );\r\n\r\n      if (response.status === 201) {\r\n        alert(\"‚úÖ Empr√©stimo solicitado com sucesso!\");\r\n        refreshBooks();\r\n      } else {\r\n        alert(\r\n          \"‚ö†Ô∏è Erro ao solicitar empr√©stimo: \" +\r\n            (response.data?.detail || \"N√£o foi poss√≠vel completar a opera√ß√£o.\")\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Erro ao solicitar empr√©stimo:\", error);\r\n\r\n      // Se 401, tentar refresh do token\r\n      if (error.response?.status === 401) {\r\n        const newToken = await refreshToken(); // Corrigido aqui\r\n        if (newToken) {\r\n          return requestLoan(); // tenta novamente\r\n        } else {\r\n          logout();\r\n          alert(\"‚ö†Ô∏è Sess√£o expirada. Fa√ßa login novamente.\");\r\n        }\r\n      } else {\r\n        const detail =\r\n          error.response?.data?.detail ||\r\n          error.response?.data?.message ||\r\n          error.message;\r\n        alert(\"‚ùå Erro ao solicitar empr√©stimo: \" + detail);\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={requestLoan}\r\n      disabled={loading || disabled}\r\n      aria-label=\"Solicitar empr√©stimo de livro\"\r\n      className={`loan-btn ${loading ? \"loading\" : \"\"}`}\r\n      style={{\r\n        padding: \"0.5rem 1rem\",\r\n        borderRadius: \"6px\",\r\n        border: \"none\",\r\n        cursor: loading || disabled ? \"not-allowed\" : \"pointer\",\r\n        backgroundColor: loading || disabled ? \"#999\" : \"#007bff\",\r\n        color: \"#fff\",\r\n        fontWeight: \"bold\",\r\n        transition: \"background 0.3s\",\r\n      }}\r\n    >\r\n      {loading ? \"üîÑ Solicitando...\" : \"üìñ Solicitar Empr√©stimo\"}\r\n    </button>\r\n  );\r\n}\r\n\r\nLoanButton.propTypes = {\r\n  bookId: PropTypes.number.isRequired,\r\n  refreshBooks: PropTypes.func.isRequired,\r\n  disabled: PropTypes.bool,\r\n};\r\n\r\nLoanButton.defaultProps = {\r\n  disabled: false,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}