{"ast":null,"code":"// src/services/ApiService.js\nconst API_URL = \"http://127.0.0.1:8000/api/\";\nimport { getAuthHeaders, refreshAccessToken, logout, isAuthenticated } from \"./auth\";\n\n/* ========================================================\r\n   üîπ Fun√ß√£o auxiliar ‚Äî faz fetch com tratamento de token expirado\r\n   ======================================================== */\nasync function fetchWithAuth(url, options = {}) {\n  let headers = {\n    ...getAuthHeaders(),\n    ...(options.headers || {})\n  };\n  let response = await fetch(url, {\n    ...options,\n    headers\n  });\n\n  // üîÅ Se o token expirou (401), tenta renovar e repetir\n  if (response.status === 401) {\n    const newToken = await refreshAccessToken();\n    if (newToken) {\n      headers = {\n        ...getAuthHeaders(),\n        ...(options.headers || {})\n      };\n      response = await fetch(url, {\n        ...options,\n        headers\n      });\n    } else {\n      logout();\n      throw new Error(\"Sess√£o expirada. Fa√ßa login novamente.\");\n    }\n  }\n  return response;\n}\n\n/* ========================================================\r\n   üîπ BOOKS ‚Äî Opera√ß√µes com livros\r\n   ======================================================== */\nexport async function getBooks() {\n  const res = await fetchWithAuth(`${API_URL}books/`);\n  if (!res.ok) throw new Error(\"Erro ao buscar livros\");\n  return res.json();\n}\nexport async function createBook(bookData) {\n  const res = await fetchWithAuth(`${API_URL}books/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(bookData)\n  });\n  if (!res.ok) throw new Error(\"Erro ao criar livro\");\n  return res.json();\n}\nexport async function updateBook(id, bookData) {\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(bookData)\n  });\n  if (!res.ok) throw new Error(\"Erro ao atualizar livro\");\n  return res.json();\n}\nexport async function deleteBook(id) {\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\n    method: \"DELETE\"\n  });\n  if (!res.ok) throw new Error(\"Erro ao deletar livro\");\n  return true;\n}\n\n/* ========================================================\r\n   üîπ USERS ‚Äî Cadastro e listagem\r\n   ======================================================== */\nexport async function getUsers() {\n  const res = await fetchWithAuth(`${API_URL}users/`);\n  if (!res.ok) throw new Error(\"Erro ao buscar usu√°rios\");\n  return res.json();\n}\nexport async function createUser(userData) {\n  const res = await fetch(`${API_URL}register/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(userData)\n  });\n  if (!res.ok) throw new Error(\"Erro ao criar usu√°rio\");\n  return res.json();\n}\n\n/* ========================================================\r\n   üîπ LOANS ‚Äî Empr√©stimos de livros\r\n   ======================================================== */\nexport async function getLoans() {\n  const res = await fetchWithAuth(`${API_URL}loans/`);\n  if (!res.ok) throw new Error(\"Erro ao buscar empr√©stimos\");\n  return res.json();\n}\nexport async function createLoan(bookId) {\n  const res = await fetchWithAuth(`${API_URL}loans/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      book: bookId\n    })\n  });\n  if (!res.ok) throw new Error(\"Erro ao criar empr√©stimo\");\n  return res.json();\n}\nexport async function returnLoan(loanId) {\n  const res = await fetchWithAuth(`${API_URL}loans/${loanId}/`, {\n    method: \"PATCH\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      returned: true\n    })\n  });\n  if (!res.ok) throw new Error(\"Erro ao devolver livro\");\n  return res.json();\n}\n\n/* ========================================================\r\n   üîπ USER SESSION ‚Äî Retorna usu√°rio atual\r\n   ======================================================== */\nexport async function getCurrentUser() {\n  if (!isAuthenticated()) return null;\n  try {\n    const res = await fetchWithAuth(`${API_URL}users/me/`);\n    if (!res.ok) return null;\n    return res.json();\n  } catch {\n    return null;\n  }\n}\n\n/* ========================================================\r\n   üîπ EXPORTS AUXILIARES\r\n   ======================================================== */\nexport { logout, refreshAccessToken as refreshToken };","map":{"version":3,"names":["API_URL","getAuthHeaders","refreshAccessToken","logout","isAuthenticated","fetchWithAuth","url","options","headers","response","fetch","status","newToken","Error","getBooks","res","ok","json","createBook","bookData","method","body","JSON","stringify","updateBook","id","deleteBook","getUsers","createUser","userData","getLoans","createLoan","bookId","book","returnLoan","loanId","returned","getCurrentUser","refreshToken"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/biblioteca/frontend/src/services/ApiService.js"],"sourcesContent":["// src/services/ApiService.js\r\nconst API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\nimport { getAuthHeaders, refreshAccessToken, logout, isAuthenticated } from \"./auth\";\r\n\r\n/* ========================================================\r\n   üîπ Fun√ß√£o auxiliar ‚Äî faz fetch com tratamento de token expirado\r\n   ======================================================== */\r\nasync function fetchWithAuth(url, options = {}) {\r\n  let headers = { ...getAuthHeaders(), ...(options.headers || {}) };\r\n  let response = await fetch(url, { ...options, headers });\r\n\r\n  // üîÅ Se o token expirou (401), tenta renovar e repetir\r\n  if (response.status === 401) {\r\n    const newToken = await refreshAccessToken();\r\n    if (newToken) {\r\n      headers = { ...getAuthHeaders(), ...(options.headers || {}) };\r\n      response = await fetch(url, { ...options, headers });\r\n    } else {\r\n      logout();\r\n      throw new Error(\"Sess√£o expirada. Fa√ßa login novamente.\");\r\n    }\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\n/* ========================================================\r\n   üîπ BOOKS ‚Äî Opera√ß√µes com livros\r\n   ======================================================== */\r\nexport async function getBooks() {\r\n  const res = await fetchWithAuth(`${API_URL}books/`);\r\n  if (!res.ok) throw new Error(\"Erro ao buscar livros\");\r\n  return res.json();\r\n}\r\n\r\nexport async function createBook(bookData) {\r\n  const res = await fetchWithAuth(`${API_URL}books/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(bookData),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao criar livro\");\r\n  return res.json();\r\n}\r\n\r\nexport async function updateBook(id, bookData) {\r\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\r\n    method: \"PUT\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(bookData),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao atualizar livro\");\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteBook(id) {\r\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\r\n    method: \"DELETE\",\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao deletar livro\");\r\n  return true;\r\n}\r\n\r\n/* ========================================================\r\n   üîπ USERS ‚Äî Cadastro e listagem\r\n   ======================================================== */\r\nexport async function getUsers() {\r\n  const res = await fetchWithAuth(`${API_URL}users/`);\r\n  if (!res.ok) throw new Error(\"Erro ao buscar usu√°rios\");\r\n  return res.json();\r\n}\r\n\r\nexport async function createUser(userData) {\r\n  const res = await fetch(`${API_URL}register/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(userData),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao criar usu√°rio\");\r\n  return res.json();\r\n}\r\n\r\n/* ========================================================\r\n   üîπ LOANS ‚Äî Empr√©stimos de livros\r\n   ======================================================== */\r\nexport async function getLoans() {\r\n  const res = await fetchWithAuth(`${API_URL}loans/`);\r\n  if (!res.ok) throw new Error(\"Erro ao buscar empr√©stimos\");\r\n  return res.json();\r\n}\r\n\r\nexport async function createLoan(bookId) {\r\n  const res = await fetchWithAuth(`${API_URL}loans/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ book: bookId }),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao criar empr√©stimo\");\r\n  return res.json();\r\n}\r\n\r\nexport async function returnLoan(loanId) {\r\n  const res = await fetchWithAuth(`${API_URL}loans/${loanId}/`, {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ returned: true }),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao devolver livro\");\r\n  return res.json();\r\n}\r\n\r\n/* ========================================================\r\n   üîπ USER SESSION ‚Äî Retorna usu√°rio atual\r\n   ======================================================== */\r\nexport async function getCurrentUser() {\r\n  if (!isAuthenticated()) return null;\r\n  try {\r\n    const res = await fetchWithAuth(`${API_URL}users/me/`);\r\n    if (!res.ok) return null;\r\n    return res.json();\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ EXPORTS AUXILIARES\r\n   ======================================================== */\r\nexport { logout, refreshAccessToken as refreshToken };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}