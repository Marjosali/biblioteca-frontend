{"ast":null,"code":"import { getAuthHeaders, refreshAccessToken, logout } from \"./auth\";\nconst API_URL = \"http://127.0.0.1:8000/api/\";\n\n/* ========================================================\r\n   ðŸ”¹ FunÃ§Ã£o auxiliar â€” fetch com token e tratamento de erro\r\n   ======================================================== */\nasync function fetchWithAuth(url, options = {}) {\n  let headers = {\n    ...getAuthHeaders(),\n    ...(options.headers || {})\n  };\n  let response = await fetch(url, {\n    ...options,\n    headers\n  });\n\n  // Se token expirou, tenta renovar\n  if (response.status === 401) {\n    const newToken = await refreshAccessToken();\n    if (newToken) {\n      headers = {\n        ...getAuthHeaders(),\n        ...(options.headers || {})\n      };\n      response = await fetch(url, {\n        ...options,\n        headers\n      });\n    } else {\n      logout();\n      throw new Error(\"SessÃ£o expirada. FaÃ§a login novamente.\");\n    }\n  }\n\n  // Tratamento de erro detalhado\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    const msg = errorData.detail || errorData.error || `Erro ${response.status}`;\n    throw new Error(msg);\n  }\n  return response;\n}\n\n/* ========================================================\r\n   ðŸ”¹ LOGIN\r\n   ======================================================== */\nexport async function login(username, password) {\n  const res = await fetch(`${API_URL}token/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!res.ok) {\n    const errorData = await res.json().catch(() => ({}));\n    throw new Error(errorData.detail || \"Erro ao fazer login\");\n  }\n  return res.json();\n}\n\n/* ========================================================\r\n   ðŸ”¹ BOOKS\r\n   ======================================================== */\nexport async function getBooks() {\n  const res = await fetchWithAuth(`${API_URL}books/`);\n  return res.json();\n}\nexport async function createBook(bookData) {\n  const res = await fetchWithAuth(`${API_URL}books/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(bookData)\n  });\n  return res.json();\n}\nexport async function updateBook(id, bookData) {\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(bookData)\n  });\n  return res.json();\n}\nexport async function deleteBook(id) {\n  await fetchWithAuth(`${API_URL}books/${id}/`, {\n    method: \"DELETE\"\n  });\n  return true;\n}\n\n/* ========================================================\r\n   ðŸ”¹ USERS\r\n   ======================================================== */\nexport async function getUsers() {\n  const res = await fetchWithAuth(`${API_URL}users/`);\n  return res.json();\n}\nexport async function createUser(userData) {\n  const res = await fetchWithAuth(`${API_URL}users/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(userData)\n  });\n  return res.json();\n}\nexport async function deleteUser(userId) {\n  await fetchWithAuth(`${API_URL}users/${userId}/`, {\n    method: \"DELETE\"\n  });\n  return true;\n}\nexport async function resetPassword(userId, newPassword) {\n  const res = await fetchWithAuth(`${API_URL}users/${userId}/`, {\n    method: \"PATCH\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      password: newPassword\n    })\n  });\n  return res.json();\n}\n\n/* ========================================================\r\n   ðŸ”¹ LOANS\r\n   ======================================================== */\nexport async function getLoans() {\n  const res = await fetchWithAuth(`${API_URL}loans/`);\n  return res.json();\n}\nexport async function createLoan(bookId) {\n  const res = await fetchWithAuth(`${API_URL}loans/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      book: bookId\n    })\n  });\n  return res.json();\n}\nexport async function returnLoan(loanId) {\n  const res = await fetchWithAuth(`${API_URL}loans/${loanId}/`, {\n    method: \"PATCH\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      returned: true\n    })\n  });\n  return res.json();\n}\n\n/* ========================================================\r\n   ðŸ”¹ USER SESSION\r\n   ======================================================== */\nexport async function getCurrentUser() {\n  try {\n    const res = await fetchWithAuth(`${API_URL}users/me/`);\n    return res.json();\n  } catch {\n    return null;\n  }\n}","map":{"version":3,"names":["getAuthHeaders","refreshAccessToken","logout","API_URL","fetchWithAuth","url","options","headers","response","fetch","status","newToken","Error","ok","errorData","json","catch","msg","detail","error","login","username","password","res","method","body","JSON","stringify","getBooks","createBook","bookData","updateBook","id","deleteBook","getUsers","createUser","userData","deleteUser","userId","resetPassword","newPassword","getLoans","createLoan","bookId","book","returnLoan","loanId","returned","getCurrentUser"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/tentativas/biblioteca/frontend/src/services/api.js"],"sourcesContent":["import { getAuthHeaders, refreshAccessToken, logout } from \"./auth\";\r\n\r\nconst API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\n/* ========================================================\r\n   ðŸ”¹ FunÃ§Ã£o auxiliar â€” fetch com token e tratamento de erro\r\n   ======================================================== */\r\nasync function fetchWithAuth(url, options = {}) {\r\n  let headers = { ...getAuthHeaders(), ...(options.headers || {}) };\r\n\r\n  let response = await fetch(url, { ...options, headers });\r\n\r\n  // Se token expirou, tenta renovar\r\n  if (response.status === 401) {\r\n    const newToken = await refreshAccessToken();\r\n    if (newToken) {\r\n      headers = { ...getAuthHeaders(), ...(options.headers || {}) };\r\n      response = await fetch(url, { ...options, headers });\r\n    } else {\r\n      logout();\r\n      throw new Error(\"SessÃ£o expirada. FaÃ§a login novamente.\");\r\n    }\r\n  }\r\n\r\n  // Tratamento de erro detalhado\r\n  if (!response.ok) {\r\n    const errorData = await response.json().catch(() => ({}));\r\n    const msg = errorData.detail || errorData.error || `Erro ${response.status}`;\r\n    throw new Error(msg);\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ LOGIN\r\n   ======================================================== */\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API_URL}token/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n\r\n  if (!res.ok) {\r\n    const errorData = await res.json().catch(() => ({}));\r\n    throw new Error(errorData.detail || \"Erro ao fazer login\");\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ BOOKS\r\n   ======================================================== */\r\nexport async function getBooks() {\r\n  const res = await fetchWithAuth(`${API_URL}books/`);\r\n  return res.json();\r\n}\r\n\r\nexport async function createBook(bookData) {\r\n  const res = await fetchWithAuth(`${API_URL}books/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(bookData),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function updateBook(id, bookData) {\r\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\r\n    method: \"PUT\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(bookData),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteBook(id) {\r\n  await fetchWithAuth(`${API_URL}books/${id}/`, { method: \"DELETE\" });\r\n  return true;\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ USERS\r\n   ======================================================== */\r\nexport async function getUsers() {\r\n  const res = await fetchWithAuth(`${API_URL}users/`);\r\n  return res.json();\r\n}\r\n\r\nexport async function createUser(userData) {\r\n  const res = await fetchWithAuth(`${API_URL}users/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(userData),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteUser(userId) {\r\n  await fetchWithAuth(`${API_URL}users/${userId}/`, { method: \"DELETE\" });\r\n  return true;\r\n}\r\n\r\nexport async function resetPassword(userId, newPassword) {\r\n  const res = await fetchWithAuth(`${API_URL}users/${userId}/`, {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ password: newPassword }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ LOANS\r\n   ======================================================== */\r\nexport async function getLoans() {\r\n  const res = await fetchWithAuth(`${API_URL}loans/`);\r\n  return res.json();\r\n}\r\n\r\nexport async function createLoan(bookId) {\r\n  const res = await fetchWithAuth(`${API_URL}loans/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ book: bookId }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\nexport async function returnLoan(loanId) {\r\n  const res = await fetchWithAuth(`${API_URL}loans/${loanId}/`, {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ returned: true }),\r\n  });\r\n  return res.json();\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ USER SESSION\r\n   ======================================================== */\r\nexport async function getCurrentUser() {\r\n  try {\r\n    const res = await fetchWithAuth(`${API_URL}users/me/`);\r\n    return res.json();\r\n  } catch {\r\n    return null;\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}