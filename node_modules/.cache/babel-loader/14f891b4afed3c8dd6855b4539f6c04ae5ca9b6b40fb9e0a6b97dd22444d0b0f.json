{"ast":null,"code":"// src/Api.js\nconst API_URL = \"http://127.0.0.1:8000/api/\";\n\n/**\r\n * ðŸ”¹ CabeÃ§alhos com token JWT\r\n */\nexport function getAuthHeaders() {\n  const token = localStorage.getItem(\"access_token\");\n  return token ? {\n    Authorization: `Bearer ${token}`,\n    \"Content-Type\": \"application/json\"\n  } : {\n    \"Content-Type\": \"application/json\"\n  };\n}\n\n/**\r\n * ðŸ”¹ Login â€” gera tokens JWT\r\n */\nexport async function login(username, password) {\n  const response = await fetch(`${API_URL}token/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!response.ok) throw new Error(\"UsuÃ¡rio ou senha incorretos\");\n  const data = await response.json();\n  localStorage.setItem(\"access_token\", data.access);\n  localStorage.setItem(\"refresh_token\", data.refresh);\n  console.log(\"ðŸ”‘ Tokens salvos com sucesso!\");\n  return data;\n}\n\n/**\r\n * ðŸ”¹ Logout â€” limpa tokens do navegador\r\n */\nexport function logout() {\n  localStorage.removeItem(\"access_token\");\n  localStorage.removeItem(\"refresh_token\");\n}\n\n/**\r\n * ðŸ”¹ Atualiza o token de acesso usando o refresh token\r\n */\nexport async function refreshToken() {\n  const refresh = localStorage.getItem(\"refresh_token\");\n  if (!refresh) return null;\n  const response = await fetch(`${API_URL}token/refresh/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      refresh\n    })\n  });\n  if (!response.ok) return null;\n  const data = await response.json();\n  localStorage.setItem(\"access_token\", data.access);\n  console.log(\"ðŸ” Token renovado com sucesso!\");\n  return data.access;\n}\n\n/**\r\n * ðŸ”¹ ObtÃ©m o usuÃ¡rio atualmente autenticado\r\n */\nexport async function getCurrentUser() {\n  let headers = getAuthHeaders();\n  let response = await fetch(`${API_URL}users/me/`, {\n    headers\n  });\n  if (response.status === 401) {\n    const refreshed = await refreshToken();\n    if (!refreshed) {\n      console.warn(\"âš ï¸ SessÃ£o expirada. FaÃ§a login novamente.\");\n      logout();\n      return null;\n    }\n    headers = getAuthHeaders();\n    response = await fetch(`${API_URL}users/me/`, {\n      headers\n    });\n  }\n  if (!response.ok) throw new Error(\"Erro ao buscar o usuÃ¡rio atual\");\n  const data = await response.json();\n  console.log(\"ðŸ‘¤ UsuÃ¡rio atual:\", data);\n  return data;\n}\n\n/**\r\n * ðŸ”¹ Lista todos os usuÃ¡rios (requer admin/superuser)\r\n */\nexport async function getUsers() {\n  const headers = getAuthHeaders();\n  const response = await fetch(`${API_URL}users/`, {\n    headers\n  });\n  if (!response.ok) throw new Error(\"Erro ao buscar usuÃ¡rios\");\n  return response.json();\n}\n\n/**\r\n * ðŸ”¹ Lista todos os livros\r\n */\nexport async function getBooks() {\n  const headers = getAuthHeaders(); // Garantindo token se necessÃ¡rio\n  const response = await fetch(`${API_URL}books/`, {\n    headers\n  });\n  if (!response.ok) throw new Error(\"Erro ao buscar livros\");\n  return response.json();\n}\n\n/**\r\n * ðŸ”¹ Cria ou atualiza livro\r\n */\nexport async function saveBook(bookData) {\n  const headers = getAuthHeaders();\n  const method = bookData.id ? \"PUT\" : \"POST\";\n  const url = bookData.id ? `${API_URL}books/${bookData.id}/` : `${API_URL}books/`;\n  const response = await fetch(url, {\n    method,\n    headers,\n    body: JSON.stringify(bookData)\n  });\n  if (!response.ok) {\n    const err = await response.json().catch(() => ({}));\n    throw new Error(err.detail || \"Erro ao salvar livro\");\n  }\n  return response.json();\n}\n\n/**\r\n * ðŸ”¹ Lista de emprÃ©stimos (loans)\r\n */\nexport async function getLoans() {\n  const headers = getAuthHeaders();\n  const response = await fetch(`${API_URL}loans/`, {\n    headers\n  });\n  if (!response.ok) {\n    if (response.status === 401) {\n      logout();\n    }\n    throw new Error(\"Erro ao buscar emprÃ©stimos\");\n  }\n  return response.json();\n}","map":{"version":3,"names":["API_URL","getAuthHeaders","token","localStorage","getItem","Authorization","login","username","password","response","fetch","method","headers","body","JSON","stringify","ok","Error","data","json","setItem","access","refresh","console","log","logout","removeItem","refreshToken","getCurrentUser","status","refreshed","warn","getUsers","getBooks","saveBook","bookData","id","url","err","catch","detail","getLoans"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/biblioteca/frontend/src/Api.js"],"sourcesContent":["// src/Api.js\r\nconst API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\n/**\r\n * ðŸ”¹ CabeÃ§alhos com token JWT\r\n */\r\nexport function getAuthHeaders() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  return token\r\n    ? { Authorization: `Bearer ${token}`, \"Content-Type\": \"application/json\" }\r\n    : { \"Content-Type\": \"application/json\" };\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Login â€” gera tokens JWT\r\n */\r\nexport async function login(username, password) {\r\n  const response = await fetch(`${API_URL}token/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n\r\n  if (!response.ok) throw new Error(\"UsuÃ¡rio ou senha incorretos\");\r\n\r\n  const data = await response.json();\r\n  localStorage.setItem(\"access_token\", data.access);\r\n  localStorage.setItem(\"refresh_token\", data.refresh);\r\n  console.log(\"ðŸ”‘ Tokens salvos com sucesso!\");\r\n  return data;\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Logout â€” limpa tokens do navegador\r\n */\r\nexport function logout() {\r\n  localStorage.removeItem(\"access_token\");\r\n  localStorage.removeItem(\"refresh_token\");\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Atualiza o token de acesso usando o refresh token\r\n */\r\nexport async function refreshToken() {\r\n  const refresh = localStorage.getItem(\"refresh_token\");\r\n  if (!refresh) return null;\r\n\r\n  const response = await fetch(`${API_URL}token/refresh/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ refresh }),\r\n  });\r\n\r\n  if (!response.ok) return null;\r\n\r\n  const data = await response.json();\r\n  localStorage.setItem(\"access_token\", data.access);\r\n  console.log(\"ðŸ” Token renovado com sucesso!\");\r\n  return data.access;\r\n}\r\n\r\n/**\r\n * ðŸ”¹ ObtÃ©m o usuÃ¡rio atualmente autenticado\r\n */\r\nexport async function getCurrentUser() {\r\n  let headers = getAuthHeaders();\r\n  let response = await fetch(`${API_URL}users/me/`, { headers });\r\n\r\n  if (response.status === 401) {\r\n    const refreshed = await refreshToken();\r\n    if (!refreshed) {\r\n      console.warn(\"âš ï¸ SessÃ£o expirada. FaÃ§a login novamente.\");\r\n      logout();\r\n      return null;\r\n    }\r\n    headers = getAuthHeaders();\r\n    response = await fetch(`${API_URL}users/me/`, { headers });\r\n  }\r\n\r\n  if (!response.ok) throw new Error(\"Erro ao buscar o usuÃ¡rio atual\");\r\n\r\n  const data = await response.json();\r\n  console.log(\"ðŸ‘¤ UsuÃ¡rio atual:\", data);\r\n  return data;\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Lista todos os usuÃ¡rios (requer admin/superuser)\r\n */\r\nexport async function getUsers() {\r\n  const headers = getAuthHeaders();\r\n  const response = await fetch(`${API_URL}users/`, { headers });\r\n  if (!response.ok) throw new Error(\"Erro ao buscar usuÃ¡rios\");\r\n  return response.json();\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Lista todos os livros\r\n */\r\nexport async function getBooks() {\r\n  const headers = getAuthHeaders(); // Garantindo token se necessÃ¡rio\r\n  const response = await fetch(`${API_URL}books/`, { headers });\r\n  if (!response.ok) throw new Error(\"Erro ao buscar livros\");\r\n  return response.json();\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Cria ou atualiza livro\r\n */\r\nexport async function saveBook(bookData) {\r\n  const headers = getAuthHeaders();\r\n  const method = bookData.id ? \"PUT\" : \"POST\";\r\n  const url = bookData.id\r\n    ? `${API_URL}books/${bookData.id}/`\r\n    : `${API_URL}books/`;\r\n\r\n  const response = await fetch(url, {\r\n    method,\r\n    headers,\r\n    body: JSON.stringify(bookData),\r\n  });\r\n\r\n  if (!response.ok) {\r\n    const err = await response.json().catch(() => ({}));\r\n    throw new Error(err.detail || \"Erro ao salvar livro\");\r\n  }\r\n  return response.json();\r\n}\r\n\r\n/**\r\n * ðŸ”¹ Lista de emprÃ©stimos (loans)\r\n */\r\nexport async function getLoans() {\r\n  const headers = getAuthHeaders();\r\n  const response = await fetch(`${API_URL}loans/`, { headers });\r\n\r\n  if (!response.ok) {\r\n    if (response.status === 401) {\r\n      logout();\r\n    }\r\n    throw new Error(\"Erro ao buscar emprÃ©stimos\");\r\n  }\r\n  return response.json();\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}