{"ast":null,"code":"const API_URL = \"http://127.0.0.1:8000/api/\";\n\n/* ========================================================\r\n   üîπ LOGIN ‚Äî Faz autentica√ß√£o JWT e salva tokens no localStorage\r\n   ======================================================== */\nexport async function login(username, password) {\n  try {\n    const response = await fetch(`${API_URL}token/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username,\n        password\n      })\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      const msg = errorData.detail || errorData.error || \"Usu√°rio ou senha inv√°lidos.\";\n      throw new Error(msg);\n    }\n    const data = await response.json();\n\n    // ‚úÖ Salva tokens no localStorage\n    localStorage.setItem(\"access_token\", data.access);\n    localStorage.setItem(\"refresh_token\", data.refresh);\n\n    // ‚úÖ Decodifica o token para extrair informa√ß√µes do usu√°rio\n    const userInfo = decodeToken(data.access);\n    localStorage.setItem(\"user_info\", JSON.stringify(userInfo));\n    return userInfo;\n  } catch (error) {\n    console.error(\"‚ùå Falha no login:\", error.message);\n    throw error;\n  }\n}\n\n/* ========================================================\r\n   üîπ REFRESH TOKEN ‚Äî Atualiza o token de acesso\r\n   ======================================================== */\nexport async function refreshAccessToken() {\n  const refresh = localStorage.getItem(\"refresh_token\");\n  if (!refresh) return null;\n  try {\n    const response = await fetch(`${API_URL}token/refresh/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        refresh\n      })\n    });\n    if (!response.ok) {\n      console.warn(\"‚ö†Ô∏è Falha ao renovar token ‚Äî sess√£o expirada.\");\n      logout();\n      return null;\n    }\n    const data = await response.json();\n    if (data.access) {\n      localStorage.setItem(\"access_token\", data.access);\n      const userInfo = decodeToken(data.access);\n      localStorage.setItem(\"user_info\", JSON.stringify(userInfo));\n      return userInfo;\n    }\n    return null;\n  } catch (error) {\n    console.error(\"‚ùå Erro ao atualizar token:\", error.message);\n    logout();\n    return null;\n  }\n}\n\n/* ========================================================\r\n   üîπ HEADERS ‚Äî Retorna cabe√ßalhos com token JWT\r\n   ======================================================== */\nexport function getAuthHeaders() {\n  const token = localStorage.getItem(\"access_token\");\n  return token ? {\n    Authorization: `Bearer ${token}`,\n    \"Content-Type\": \"application/json\"\n  } : {\n    \"Content-Type\": \"application/json\"\n  };\n}\n\n/* ========================================================\r\n   üîπ DECODE TOKEN ‚Äî L√™ dados do usu√°rio do JWT\r\n   ======================================================== */\nexport function decodeToken(token) {\n  try {\n    const payload = JSON.parse(atob(token.split(\".\")[1]));\n    return {\n      user_id: payload.user_id || null,\n      username: payload.username || \"\",\n      email: payload.email || \"\",\n      is_staff: payload.is_staff || false,\n      is_superuser: payload.is_superuser || false,\n      exp: payload.exp || 0\n    };\n  } catch (error) {\n    console.error(\"‚ùå Erro ao decodificar token:\", error.message);\n    return null;\n  }\n}\n\n/* ========================================================\r\n   üîπ GET USER INFO ‚Äî Retorna o usu√°rio logado (do localStorage)\r\n   ======================================================== */\nexport function getUserInfo() {\n  const userInfo = localStorage.getItem(\"user_info\");\n  return userInfo ? JSON.parse(userInfo) : null;\n}\n\n/* ========================================================\r\n   üîπ AUTH STATUS ‚Äî Verifica se o token JWT ainda √© v√°lido\r\n   ======================================================== */\nexport function isAuthenticated() {\n  const token = localStorage.getItem(\"access_token\");\n  if (!token) return false;\n  try {\n    const {\n      exp\n    } = JSON.parse(atob(token.split(\".\")[1]));\n    return Date.now() < exp * 1000;\n  } catch {\n    return false;\n  }\n}\n\n/* ========================================================\r\n   üîπ LOGOUT ‚Äî Limpa a sess√£o do usu√°rio\r\n   ======================================================== */\nexport function logout() {\n  localStorage.removeItem(\"access_token\");\n  localStorage.removeItem(\"refresh_token\");\n  localStorage.removeItem(\"user_info\");\n}","map":{"version":3,"names":["API_URL","login","username","password","response","fetch","method","headers","body","JSON","stringify","ok","errorData","json","catch","msg","detail","error","Error","data","localStorage","setItem","access","refresh","userInfo","decodeToken","console","message","refreshAccessToken","getItem","warn","logout","getAuthHeaders","token","Authorization","payload","parse","atob","split","user_id","email","is_staff","is_superuser","exp","getUserInfo","isAuthenticated","Date","now","removeItem"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/tentativas/biblioteca/frontend/src/services/auth.js"],"sourcesContent":["const API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\n/* ========================================================\r\n   üîπ LOGIN ‚Äî Faz autentica√ß√£o JWT e salva tokens no localStorage\r\n   ======================================================== */\r\nexport async function login(username, password) {\r\n  try {\r\n    const response = await fetch(`${API_URL}token/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ username, password }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      const msg =\r\n        errorData.detail || errorData.error || \"Usu√°rio ou senha inv√°lidos.\";\r\n      throw new Error(msg);\r\n    }\r\n\r\n    const data = await response.json();\r\n\r\n    // ‚úÖ Salva tokens no localStorage\r\n    localStorage.setItem(\"access_token\", data.access);\r\n    localStorage.setItem(\"refresh_token\", data.refresh);\r\n\r\n    // ‚úÖ Decodifica o token para extrair informa√ß√µes do usu√°rio\r\n    const userInfo = decodeToken(data.access);\r\n    localStorage.setItem(\"user_info\", JSON.stringify(userInfo));\r\n\r\n    return userInfo;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Falha no login:\", error.message);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ REFRESH TOKEN ‚Äî Atualiza o token de acesso\r\n   ======================================================== */\r\nexport async function refreshAccessToken() {\r\n  const refresh = localStorage.getItem(\"refresh_token\");\r\n  if (!refresh) return null;\r\n\r\n  try {\r\n    const response = await fetch(`${API_URL}token/refresh/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ refresh }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      console.warn(\"‚ö†Ô∏è Falha ao renovar token ‚Äî sess√£o expirada.\");\r\n      logout();\r\n      return null;\r\n    }\r\n\r\n    const data = await response.json();\r\n    if (data.access) {\r\n      localStorage.setItem(\"access_token\", data.access);\r\n      const userInfo = decodeToken(data.access);\r\n      localStorage.setItem(\"user_info\", JSON.stringify(userInfo));\r\n      return userInfo;\r\n    }\r\n\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao atualizar token:\", error.message);\r\n    logout();\r\n    return null;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ HEADERS ‚Äî Retorna cabe√ßalhos com token JWT\r\n   ======================================================== */\r\nexport function getAuthHeaders() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  return token\r\n    ? {\r\n        Authorization: `Bearer ${token}`,\r\n        \"Content-Type\": \"application/json\",\r\n      }\r\n    : { \"Content-Type\": \"application/json\" };\r\n}\r\n\r\n/* ========================================================\r\n   üîπ DECODE TOKEN ‚Äî L√™ dados do usu√°rio do JWT\r\n   ======================================================== */\r\nexport function decodeToken(token) {\r\n  try {\r\n    const payload = JSON.parse(atob(token.split(\".\")[1]));\r\n    return {\r\n      user_id: payload.user_id || null,\r\n      username: payload.username || \"\",\r\n      email: payload.email || \"\",\r\n      is_staff: payload.is_staff || false,\r\n      is_superuser: payload.is_superuser || false,\r\n      exp: payload.exp || 0,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao decodificar token:\", error.message);\r\n    return null;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ GET USER INFO ‚Äî Retorna o usu√°rio logado (do localStorage)\r\n   ======================================================== */\r\nexport function getUserInfo() {\r\n  const userInfo = localStorage.getItem(\"user_info\");\r\n  return userInfo ? JSON.parse(userInfo) : null;\r\n}\r\n\r\n/* ========================================================\r\n   üîπ AUTH STATUS ‚Äî Verifica se o token JWT ainda √© v√°lido\r\n   ======================================================== */\r\nexport function isAuthenticated() {\r\n  const token = localStorage.getItem(\"access_token\");\r\n  if (!token) return false;\r\n\r\n  try {\r\n    const { exp } = JSON.parse(atob(token.split(\".\")[1]));\r\n    return Date.now() < exp * 1000;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   üîπ LOGOUT ‚Äî Limpa a sess√£o do usu√°rio\r\n   ======================================================== */\r\nexport function logout() {\r\n  localStorage.removeItem(\"access_token\");\r\n  localStorage.removeItem(\"refresh_token\");\r\n  localStorage.removeItem(\"user_info\");\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}