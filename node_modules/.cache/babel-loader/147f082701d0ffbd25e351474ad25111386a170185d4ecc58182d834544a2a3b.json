{"ast":null,"code":"import { getAuthHeaders, refreshAccessToken, logout, isAuthenticated } from \"./auth\";\nconst API_URL = \"http://127.0.0.1:8000/api/\";\n\n/* ========================================================\r\n   ðŸ”¹ FunÃ§Ã£o auxiliar â€” fetch com token expirado\r\n   ======================================================== */\nasync function fetchWithAuth(url, options = {}) {\n  let headers = {\n    ...getAuthHeaders(),\n    ...(options.headers || {})\n  };\n  let response = await fetch(url, {\n    ...options,\n    headers\n  });\n\n  // ðŸ” Se o token expirou (401), tenta renovar e repetir\n  if (response.status === 401) {\n    const newToken = await refreshAccessToken();\n    if (newToken) {\n      headers = {\n        ...getAuthHeaders(),\n        ...(options.headers || {})\n      };\n      response = await fetch(url, {\n        ...options,\n        headers\n      });\n    } else {\n      logout();\n      throw new Error(\"SessÃ£o expirada. FaÃ§a login novamente.\");\n    }\n  }\n  return response;\n}\n\n/* ========================================================\r\n   ðŸ”¹ LOGIN\r\n   ======================================================== */\nexport async function login(username, password) {\n  const res = await fetch(`${API_URL}token/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  if (!res.ok) throw new Error(\"Erro ao fazer login\");\n  const data = await res.json();\n  localStorage.setItem(\"access_token\", data.access);\n  localStorage.setItem(\"refresh_token\", data.refresh);\n  return data;\n}\n\n/* ========================================================\r\n   ðŸ”¹ BOOKS\r\n   ======================================================== */\nexport async function getBooks() {\n  const res = await fetchWithAuth(`${API_URL}books/`);\n  if (!res.ok) throw new Error(\"Erro ao buscar livros\");\n  return res.json();\n}\nexport async function createBook(bookData) {\n  const res = await fetchWithAuth(`${API_URL}books/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(bookData)\n  });\n  if (!res.ok) throw new Error(\"Erro ao criar livro\");\n  return res.json();\n}\nexport async function updateBook(id, bookData) {\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\n    method: \"PUT\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(bookData)\n  });\n  if (!res.ok) throw new Error(\"Erro ao atualizar livro\");\n  return res.json();\n}\nexport async function deleteBook(id) {\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\n    method: \"DELETE\"\n  });\n  if (!res.ok) throw new Error(\"Erro ao deletar livro\");\n  return true;\n}\n\n/* ========================================================\r\n   ðŸ”¹ USERS â€” Cadastro e listagem\r\n   ======================================================== */\nexport async function getUsers() {\n  const res = await fetchWithAuth(`${API_URL}users/`);\n  if (!res.ok) throw new Error(\"Erro ao buscar usuÃ¡rios\");\n  return res.json();\n}\nexport async function createUser(userData) {\n  const res = await fetchWithAuth(`${API_URL}users/`, {\n    // ðŸ”¹ corrigido endpoint e auth\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify(userData)\n  });\n  const data = await res.json().catch(() => ({}));\n  if (!res.ok) {\n    const msg = data.detail || JSON.stringify(data) || \"Erro ao criar usuÃ¡rio\";\n    throw new Error(msg);\n  }\n  return data;\n}\n\n/* ========================================================\r\n   ðŸ”¹ LOANS\r\n   ======================================================== */\nexport async function getLoans() {\n  const res = await fetchWithAuth(`${API_URL}loans/`);\n  if (!res.ok) throw new Error(\"Erro ao buscar emprÃ©stimos\");\n  return res.json();\n}\nexport async function createLoan(bookId) {\n  const res = await fetchWithAuth(`${API_URL}loans/`, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      book: bookId\n    })\n  });\n  if (!res.ok) throw new Error(\"Erro ao criar emprÃ©stimo\");\n  return res.json();\n}\nexport async function returnLoan(loanId) {\n  const res = await fetchWithAuth(`${API_URL}loans/${loanId}/`, {\n    method: \"PATCH\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      returned: true\n    })\n  });\n  if (!res.ok) throw new Error(\"Erro ao devolver livro\");\n  return res.json();\n}\n\n/* ========================================================\r\n   ðŸ”¹ USER SESSION â€” Retorna usuÃ¡rio atual\r\n   ======================================================== */\nexport async function getCurrentUser() {\n  if (!isAuthenticated()) return null;\n  try {\n    const res = await fetchWithAuth(`${API_URL}users/me/`);\n    if (!res.ok) return null;\n    return res.json();\n  } catch {\n    return null;\n  }\n}\n\n/* ========================================================\r\n   ðŸ”¹ EXPORTS AUXILIARES\r\n   ======================================================== */\nexport { logout, refreshAccessToken as refreshToken };","map":{"version":3,"names":["getAuthHeaders","refreshAccessToken","logout","isAuthenticated","API_URL","fetchWithAuth","url","options","headers","response","fetch","status","newToken","Error","login","username","password","res","method","body","JSON","stringify","ok","data","json","localStorage","setItem","access","refresh","getBooks","createBook","bookData","updateBook","id","deleteBook","getUsers","createUser","userData","catch","msg","detail","getLoans","createLoan","bookId","book","returnLoan","loanId","returned","getCurrentUser","refreshToken"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/biblioteca/frontend/src/services/ApiService.js"],"sourcesContent":["import { getAuthHeaders, refreshAccessToken, logout, isAuthenticated } from \"./auth\";\r\n\r\nconst API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\n/* ========================================================\r\n   ðŸ”¹ FunÃ§Ã£o auxiliar â€” fetch com token expirado\r\n   ======================================================== */\r\nasync function fetchWithAuth(url, options = {}) {\r\n  let headers = { ...getAuthHeaders(), ...(options.headers || {}) };\r\n  let response = await fetch(url, { ...options, headers });\r\n\r\n  // ðŸ” Se o token expirou (401), tenta renovar e repetir\r\n  if (response.status === 401) {\r\n    const newToken = await refreshAccessToken();\r\n    if (newToken) {\r\n      headers = { ...getAuthHeaders(), ...(options.headers || {}) };\r\n      response = await fetch(url, { ...options, headers });\r\n    } else {\r\n      logout();\r\n      throw new Error(\"SessÃ£o expirada. FaÃ§a login novamente.\");\r\n    }\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ LOGIN\r\n   ======================================================== */\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API_URL}token/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n\r\n  if (!res.ok) throw new Error(\"Erro ao fazer login\");\r\n\r\n  const data = await res.json();\r\n  localStorage.setItem(\"access_token\", data.access);\r\n  localStorage.setItem(\"refresh_token\", data.refresh);\r\n  return data;\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ BOOKS\r\n   ======================================================== */\r\nexport async function getBooks() {\r\n  const res = await fetchWithAuth(`${API_URL}books/`);\r\n  if (!res.ok) throw new Error(\"Erro ao buscar livros\");\r\n  return res.json();\r\n}\r\n\r\nexport async function createBook(bookData) {\r\n  const res = await fetchWithAuth(`${API_URL}books/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(bookData),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao criar livro\");\r\n  return res.json();\r\n}\r\n\r\nexport async function updateBook(id, bookData) {\r\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\r\n    method: \"PUT\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(bookData),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao atualizar livro\");\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteBook(id) {\r\n  const res = await fetchWithAuth(`${API_URL}books/${id}/`, {\r\n    method: \"DELETE\",\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao deletar livro\");\r\n  return true;\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ USERS â€” Cadastro e listagem\r\n   ======================================================== */\r\nexport async function getUsers() {\r\n  const res = await fetchWithAuth(`${API_URL}users/`);\r\n  if (!res.ok) throw new Error(\"Erro ao buscar usuÃ¡rios\");\r\n  return res.json();\r\n}\r\n\r\nexport async function createUser(userData) {\r\n  const res = await fetchWithAuth(`${API_URL}users/`, { // ðŸ”¹ corrigido endpoint e auth\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify(userData),\r\n  });\r\n\r\n  const data = await res.json().catch(() => ({}));\r\n\r\n  if (!res.ok) {\r\n    const msg = data.detail || JSON.stringify(data) || \"Erro ao criar usuÃ¡rio\";\r\n    throw new Error(msg);\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ LOANS\r\n   ======================================================== */\r\nexport async function getLoans() {\r\n  const res = await fetchWithAuth(`${API_URL}loans/`);\r\n  if (!res.ok) throw new Error(\"Erro ao buscar emprÃ©stimos\");\r\n  return res.json();\r\n}\r\n\r\nexport async function createLoan(bookId) {\r\n  const res = await fetchWithAuth(`${API_URL}loans/`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ book: bookId }),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao criar emprÃ©stimo\");\r\n  return res.json();\r\n}\r\n\r\nexport async function returnLoan(loanId) {\r\n  const res = await fetchWithAuth(`${API_URL}loans/${loanId}/`, {\r\n    method: \"PATCH\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({ returned: true }),\r\n  });\r\n  if (!res.ok) throw new Error(\"Erro ao devolver livro\");\r\n  return res.json();\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ USER SESSION â€” Retorna usuÃ¡rio atual\r\n   ======================================================== */\r\nexport async function getCurrentUser() {\r\n  if (!isAuthenticated()) return null;\r\n  try {\r\n    const res = await fetchWithAuth(`${API_URL}users/me/`);\r\n    if (!res.ok) return null;\r\n    return res.json();\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/* ========================================================\r\n   ðŸ”¹ EXPORTS AUXILIARES\r\n   ======================================================== */\r\nexport { logout, refreshAccessToken as refreshToken };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}