{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\MARCIOJOSEDOSSANTOS\\\\Desktop\\\\tentativas\\\\biblioteca\\\\frontend\\\\src\\\\components\\\\LoanButton.js\",\n  _s = $RefreshSig$();\n// src/components/LoanButton.js\nimport React, { useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { refreshAccessToken, logout, getAuthHeaders } from \"../services/auth\"; // ‚úÖ agora vem de auth.js\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = \"http://127.0.0.1:8000/api/\";\nexport default function LoanButton({\n  bookId,\n  refreshBooks,\n  disabled\n}) {\n  _s();\n  const [loading, setLoading] = useState(false);\n  const requestLoan = async () => {\n    const token = localStorage.getItem(\"access_token\");\n    if (!token) {\n      alert(\"‚ö†Ô∏è Voc√™ precisa estar logado para solicitar um empr√©stimo!\");\n      return;\n    }\n    setLoading(true);\n    try {\n      let res = await fetch(`${API_URL}loans/`, {\n        method: \"POST\",\n        headers: {\n          ...getAuthHeaders(),\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          book: bookId\n        })\n      });\n\n      // üîπ Token expirado ‚Üí tenta renovar e repetir a requisi√ß√£o\n      if (res.status === 401) {\n        const newToken = await refreshAccessToken();\n        if (newToken) {\n          res = await fetch(`${API_URL}loans/`, {\n            method: \"POST\",\n            headers: {\n              Authorization: `Bearer ${newToken}`,\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              book: bookId\n            })\n          });\n        } else {\n          logout();\n          alert(\"‚ö†Ô∏è Sess√£o expirada. Fa√ßa login novamente.\");\n          return;\n        }\n      }\n\n      // üîπ Sucesso\n      if (res.ok) {\n        alert(\"‚úÖ Empr√©stimo solicitado com sucesso!\");\n        if (refreshBooks) refreshBooks();\n        return;\n      }\n\n      // üîπ Erro gen√©rico\n      const errData = await res.json().catch(() => ({}));\n      alert(\"‚ö†Ô∏è Erro ao solicitar empr√©stimo: \" + (errData.detail || \"N√£o foi poss√≠vel completar a opera√ß√£o.\"));\n    } catch (error) {\n      console.error(\"Erro ao solicitar empr√©stimo:\", error);\n      alert(\"‚ùå Ocorreu um erro inesperado. Tente novamente mais tarde.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: requestLoan,\n    disabled: loading || disabled,\n    \"aria-label\": \"Solicitar empr\\xE9stimo de livro\",\n    \"aria-live\": \"polite\",\n    className: `loan-btn ${loading ? \"loading\" : \"\"}`,\n    style: {\n      padding: \"0.5rem 1rem\",\n      borderRadius: \"6px\",\n      border: \"none\",\n      cursor: loading || disabled ? \"not-allowed\" : \"pointer\",\n      backgroundColor: loading || disabled ? \"#999\" : \"#007bff\",\n      color: \"#fff\",\n      fontWeight: \"bold\",\n      transition: \"background 0.3s\"\n    },\n    children: loading ? \"üîÑ Solicitando empr√©stimo...\" : \"üìñ Solicitar Empr√©stimo\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this);\n}\n_s(LoanButton, \"/Rjh5rPqCCqf0XYnTUk9ZNavw3Q=\");\n_c = LoanButton;\nLoanButton.propTypes = {\n  bookId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n  refreshBooks: PropTypes.func.isRequired,\n  disabled: PropTypes.bool\n};\nLoanButton.defaultProps = {\n  disabled: false\n};\nvar _c;\n$RefreshReg$(_c, \"LoanButton\");","map":{"version":3,"names":["React","useState","PropTypes","refreshAccessToken","logout","getAuthHeaders","jsxDEV","_jsxDEV","API_URL","LoanButton","bookId","refreshBooks","disabled","_s","loading","setLoading","requestLoan","token","localStorage","getItem","alert","res","fetch","method","headers","body","JSON","stringify","book","status","newToken","Authorization","ok","errData","json","catch","detail","error","console","onClick","className","style","padding","borderRadius","border","cursor","backgroundColor","color","fontWeight","transition","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","propTypes","oneOfType","number","string","isRequired","func","bool","defaultProps","$RefreshReg$"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/tentativas/biblioteca/frontend/src/components/LoanButton.js"],"sourcesContent":["// src/components/LoanButton.js\r\nimport React, { useState } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport {\r\n  refreshAccessToken,\r\n  logout,\r\n  getAuthHeaders,\r\n} from \"../services/auth\"; // ‚úÖ agora vem de auth.js\r\n\r\nconst API_URL = \"http://127.0.0.1:8000/api/\";\r\n\r\nexport default function LoanButton({ bookId, refreshBooks, disabled }) {\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const requestLoan = async () => {\r\n    const token = localStorage.getItem(\"access_token\");\r\n    if (!token) {\r\n      alert(\"‚ö†Ô∏è Voc√™ precisa estar logado para solicitar um empr√©stimo!\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      let res = await fetch(`${API_URL}loans/`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          ...getAuthHeaders(),\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({ book: bookId }),\r\n      });\r\n\r\n      // üîπ Token expirado ‚Üí tenta renovar e repetir a requisi√ß√£o\r\n      if (res.status === 401) {\r\n        const newToken = await refreshAccessToken();\r\n        if (newToken) {\r\n          res = await fetch(`${API_URL}loans/`, {\r\n            method: \"POST\",\r\n            headers: {\r\n              Authorization: `Bearer ${newToken}`,\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({ book: bookId }),\r\n          });\r\n        } else {\r\n          logout();\r\n          alert(\"‚ö†Ô∏è Sess√£o expirada. Fa√ßa login novamente.\");\r\n          return;\r\n        }\r\n      }\r\n\r\n      // üîπ Sucesso\r\n      if (res.ok) {\r\n        alert(\"‚úÖ Empr√©stimo solicitado com sucesso!\");\r\n        if (refreshBooks) refreshBooks();\r\n        return;\r\n      }\r\n\r\n      // üîπ Erro gen√©rico\r\n      const errData = await res.json().catch(() => ({}));\r\n      alert(\r\n        \"‚ö†Ô∏è Erro ao solicitar empr√©stimo: \" +\r\n          (errData.detail || \"N√£o foi poss√≠vel completar a opera√ß√£o.\")\r\n      );\r\n    } catch (error) {\r\n      console.error(\"Erro ao solicitar empr√©stimo:\", error);\r\n      alert(\"‚ùå Ocorreu um erro inesperado. Tente novamente mais tarde.\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      onClick={requestLoan}\r\n      disabled={loading || disabled}\r\n      aria-label=\"Solicitar empr√©stimo de livro\"\r\n      aria-live=\"polite\"\r\n      className={`loan-btn ${loading ? \"loading\" : \"\"}`}\r\n      style={{\r\n        padding: \"0.5rem 1rem\",\r\n        borderRadius: \"6px\",\r\n        border: \"none\",\r\n        cursor: loading || disabled ? \"not-allowed\" : \"pointer\",\r\n        backgroundColor: loading || disabled ? \"#999\" : \"#007bff\",\r\n        color: \"#fff\",\r\n        fontWeight: \"bold\",\r\n        transition: \"background 0.3s\",\r\n      }}\r\n    >\r\n      {loading ? \"üîÑ Solicitando empr√©stimo...\" : \"üìñ Solicitar Empr√©stimo\"}\r\n    </button>\r\n  );\r\n}\r\n\r\nLoanButton.propTypes = {\r\n  bookId: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\r\n  refreshBooks: PropTypes.func.isRequired,\r\n  disabled: PropTypes.bool,\r\n};\r\n\r\nLoanButton.defaultProps = {\r\n  disabled: false,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}