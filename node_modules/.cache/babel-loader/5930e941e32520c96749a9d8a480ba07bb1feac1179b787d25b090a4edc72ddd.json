{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\MARCIOJOSEDOSSANTOS\\\\Desktop\\\\tentativas\\\\biblioteca\\\\frontend\\\\src\\\\components\\\\LoanForm.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { getBooks, getLoans, createLoan, returnBook } from \"../Api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function LoanForm({\n  onSave\n}) {\n  _s();\n  var _JSON$parse;\n  const [books, setBooks] = useState([]);\n  const [loans, setLoans] = useState([]);\n  const [selectedBook, setSelectedBook] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const isSuperUser = (_JSON$parse = JSON.parse(localStorage.getItem(\"user_info\"))) === null || _JSON$parse === void 0 ? void 0 : _JSON$parse.is_superuser;\n  if (!isSuperUser) {\n    return /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"access-denied\",\n      children: \"\\u26A0\\uFE0F Acesso negado. Apenas superusu\\xE1rios podem gerenciar empr\\xE9stimos.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 12\n    }, this);\n  }\n  const fetchData = async () => {\n    const booksData = await getBooks();\n    const loansData = await getLoans();\n    setBooks(booksData);\n    setLoans(loansData);\n  };\n  useEffect(() => {\n    fetchData();\n  }, []);\n  const handleLoan = async e => {\n    e.preventDefault();\n    if (!selectedBook) {\n      setMessage(\"‚ö†Ô∏è Selecione um livro.\");\n      return;\n    }\n    try {\n      await createLoan({\n        book: selectedBook\n      });\n      setMessage(\"‚úÖ Empr√©stimo registrado!\");\n      setSelectedBook(\"\");\n      fetchData();\n      onSave === null || onSave === void 0 ? void 0 : onSave();\n    } catch (error) {\n      setMessage(`‚ùå Erro: ${error.message}`);\n    }\n  };\n  const handleReturn = async loanId => {\n    try {\n      await returnBook({\n        loan_id: loanId\n      });\n      setMessage(\"‚úÖ Devolu√ß√£o registrada!\");\n      fetchData();\n      onSave === null || onSave === void 0 ? void 0 : onSave();\n    } catch (error) {\n      setMessage(`‚ùå Erro: ${error.message}`);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loan-form\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"\\uD83D\\uDCDA Gerenciar Empr\\xE9stimos\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }, this), message && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleLoan,\n      children: [/*#__PURE__*/_jsxDEV(\"select\", {\n        value: selectedBook,\n        onChange: e => setSelectedBook(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"-- Selecione um livro --\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 11\n        }, this), books.map(b => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: b.id,\n          children: b.title\n        }, b.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        children: \"Emprestar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Empr\\xE9stimos Ativos\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: loans.filter(l => !l.returned).map(l => {\n        var _l$book, _l$user;\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [(_l$book = l.book) === null || _l$book === void 0 ? void 0 : _l$book.title, \" \\u2014 \", (_l$user = l.user) === null || _l$user === void 0 ? void 0 : _l$user.username, /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleReturn(l.id),\n            children: \"Devolver\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 13\n          }, this)]\n        }, l.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 5\n  }, this);\n}\n_s(LoanForm, \"4vE8wX1yCP70j3WJz/Lq0Ml5JwE=\");\n_c = LoanForm;\nvar _c;\n$RefreshReg$(_c, \"LoanForm\");","map":{"version":3,"names":["React","useState","useEffect","getBooks","getLoans","createLoan","returnBook","jsxDEV","_jsxDEV","LoanForm","onSave","_s","_JSON$parse","books","setBooks","loans","setLoans","selectedBook","setSelectedBook","message","setMessage","isSuperUser","JSON","parse","localStorage","getItem","is_superuser","className","children","fileName","_jsxFileName","lineNumber","columnNumber","fetchData","booksData","loansData","handleLoan","e","preventDefault","book","error","handleReturn","loanId","loan_id","onSubmit","value","onChange","target","map","b","id","title","type","filter","l","returned","_l$book","_l$user","user","username","onClick","_c","$RefreshReg$"],"sources":["C:/Users/MARCIOJOSEDOSSANTOS/Desktop/tentativas/biblioteca/frontend/src/components/LoanForm.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { getBooks, getLoans, createLoan, returnBook } from \"../Api\";\r\n\r\nexport default function LoanForm({ onSave }) {\r\n  const [books, setBooks] = useState([]);\r\n  const [loans, setLoans] = useState([]);\r\n  const [selectedBook, setSelectedBook] = useState(\"\");\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const isSuperUser = JSON.parse(localStorage.getItem(\"user_info\"))?.is_superuser;\r\n\r\n  if (!isSuperUser) {\r\n    return <p className=\"access-denied\">‚ö†Ô∏è Acesso negado. Apenas superusu√°rios podem gerenciar empr√©stimos.</p>;\r\n  }\r\n\r\n  const fetchData = async () => {\r\n    const booksData = await getBooks();\r\n    const loansData = await getLoans();\r\n    setBooks(booksData);\r\n    setLoans(loansData);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleLoan = async (e) => {\r\n    e.preventDefault();\r\n    if (!selectedBook) {\r\n      setMessage(\"‚ö†Ô∏è Selecione um livro.\");\r\n      return;\r\n    }\r\n    try {\r\n      await createLoan({ book: selectedBook });\r\n      setMessage(\"‚úÖ Empr√©stimo registrado!\");\r\n      setSelectedBook(\"\");\r\n      fetchData();\r\n      onSave?.();\r\n    } catch (error) {\r\n      setMessage(`‚ùå Erro: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleReturn = async (loanId) => {\r\n    try {\r\n      await returnBook({ loan_id: loanId });\r\n      setMessage(\"‚úÖ Devolu√ß√£o registrada!\");\r\n      fetchData();\r\n      onSave?.();\r\n    } catch (error) {\r\n      setMessage(`‚ùå Erro: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"loan-form\">\r\n      <h3>üìö Gerenciar Empr√©stimos</h3>\r\n      {message && <p>{message}</p>}\r\n      <form onSubmit={handleLoan}>\r\n        <select value={selectedBook} onChange={(e) => setSelectedBook(e.target.value)}>\r\n          <option value=\"\">-- Selecione um livro --</option>\r\n          {books.map((b) => (\r\n            <option key={b.id} value={b.id}>{b.title}</option>\r\n          ))}\r\n        </select>\r\n        <button type=\"submit\">Emprestar</button>\r\n      </form>\r\n\r\n      <h4>Empr√©stimos Ativos</h4>\r\n      <ul>\r\n        {loans.filter((l) => !l.returned).map((l) => (\r\n          <li key={l.id}>\r\n            {l.book?.title} ‚Äî {l.user?.username}\r\n            <button onClick={() => handleReturn(l.id)}>Devolver</button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,SAASC,QAAQ,EAAEC,QAAQ,EAAEC,UAAU,EAAEC,UAAU,QAAQ,QAAQ;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEpE,eAAe,SAASC,QAAQA,CAAC;EAAEC;AAAO,CAAC,EAAE;EAAAC,EAAA;EAAA,IAAAC,WAAA;EAC3C,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACc,KAAK,EAAEC,QAAQ,CAAC,GAAGf,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACgB,YAAY,EAAEC,eAAe,CAAC,GAAGjB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACkB,OAAO,EAAEC,UAAU,CAAC,GAAGnB,QAAQ,CAAC,EAAE,CAAC;EAE1C,MAAMoB,WAAW,IAAAT,WAAA,GAAGU,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,cAAAb,WAAA,uBAA7CA,WAAA,CAA+Cc,YAAY;EAE/E,IAAI,CAACL,WAAW,EAAE;IAChB,oBAAOb,OAAA;MAAGmB,SAAS,EAAC,eAAe;MAAAC,QAAA,EAAC;IAAmE;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAG,CAAC;EAC7G;EAEA,MAAMC,SAAS,GAAG,MAAAA,CAAA,KAAY;IAC5B,MAAMC,SAAS,GAAG,MAAM/B,QAAQ,CAAC,CAAC;IAClC,MAAMgC,SAAS,GAAG,MAAM/B,QAAQ,CAAC,CAAC;IAClCU,QAAQ,CAACoB,SAAS,CAAC;IACnBlB,QAAQ,CAACmB,SAAS,CAAC;EACrB,CAAC;EAEDjC,SAAS,CAAC,MAAM;IACd+B,SAAS,CAAC,CAAC;EACb,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMG,UAAU,GAAG,MAAOC,CAAC,IAAK;IAC9BA,CAAC,CAACC,cAAc,CAAC,CAAC;IAClB,IAAI,CAACrB,YAAY,EAAE;MACjBG,UAAU,CAAC,wBAAwB,CAAC;MACpC;IACF;IACA,IAAI;MACF,MAAMf,UAAU,CAAC;QAAEkC,IAAI,EAAEtB;MAAa,CAAC,CAAC;MACxCG,UAAU,CAAC,0BAA0B,CAAC;MACtCF,eAAe,CAAC,EAAE,CAAC;MACnBe,SAAS,CAAC,CAAC;MACXvB,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAG,CAAC;IACZ,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdpB,UAAU,CAAC,WAAWoB,KAAK,CAACrB,OAAO,EAAE,CAAC;IACxC;EACF,CAAC;EAED,MAAMsB,YAAY,GAAG,MAAOC,MAAM,IAAK;IACrC,IAAI;MACF,MAAMpC,UAAU,CAAC;QAAEqC,OAAO,EAAED;MAAO,CAAC,CAAC;MACrCtB,UAAU,CAAC,yBAAyB,CAAC;MACrCa,SAAS,CAAC,CAAC;MACXvB,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAG,CAAC;IACZ,CAAC,CAAC,OAAO8B,KAAK,EAAE;MACdpB,UAAU,CAAC,WAAWoB,KAAK,CAACrB,OAAO,EAAE,CAAC;IACxC;EACF,CAAC;EAED,oBACEX,OAAA;IAAKmB,SAAS,EAAC,WAAW;IAAAC,QAAA,gBACxBpB,OAAA;MAAAoB,QAAA,EAAI;IAAwB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,EAChCb,OAAO,iBAAIX,OAAA;MAAAoB,QAAA,EAAIT;IAAO;MAAAU,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAC5BxB,OAAA;MAAMoC,QAAQ,EAAER,UAAW;MAAAR,QAAA,gBACzBpB,OAAA;QAAQqC,KAAK,EAAE5B,YAAa;QAAC6B,QAAQ,EAAGT,CAAC,IAAKnB,eAAe,CAACmB,CAAC,CAACU,MAAM,CAACF,KAAK,CAAE;QAAAjB,QAAA,gBAC5EpB,OAAA;UAAQqC,KAAK,EAAC,EAAE;UAAAjB,QAAA,EAAC;QAAwB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,EACjDnB,KAAK,CAACmC,GAAG,CAAEC,CAAC,iBACXzC,OAAA;UAAmBqC,KAAK,EAAEI,CAAC,CAACC,EAAG;UAAAtB,QAAA,EAAEqB,CAAC,CAACE;QAAK,GAA3BF,CAAC,CAACC,EAAE;UAAArB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAgC,CAClD,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACI,CAAC,eACTxB,OAAA;QAAQ4C,IAAI,EAAC,QAAQ;QAAAxB,QAAA,EAAC;MAAS;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpC,CAAC,eAEPxB,OAAA;MAAAoB,QAAA,EAAI;IAAkB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAC3BxB,OAAA;MAAAoB,QAAA,EACGb,KAAK,CAACsC,MAAM,CAAEC,CAAC,IAAK,CAACA,CAAC,CAACC,QAAQ,CAAC,CAACP,GAAG,CAAEM,CAAC;QAAA,IAAAE,OAAA,EAAAC,OAAA;QAAA,oBACtCjD,OAAA;UAAAoB,QAAA,IAAA4B,OAAA,GACGF,CAAC,CAACf,IAAI,cAAAiB,OAAA,uBAANA,OAAA,CAAQL,KAAK,EAAC,UAAG,GAAAM,OAAA,GAACH,CAAC,CAACI,IAAI,cAAAD,OAAA,uBAANA,OAAA,CAAQE,QAAQ,eACnCnD,OAAA;YAAQoD,OAAO,EAAEA,CAAA,KAAMnB,YAAY,CAACa,CAAC,CAACJ,EAAE,CAAE;YAAAtB,QAAA,EAAC;UAAQ;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA,GAFrDsB,CAAC,CAACJ,EAAE;UAAArB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAGT,CAAC;MAAA,CACN;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACA,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACF,CAAC;AAEV;AAACrB,EAAA,CA5EuBF,QAAQ;AAAAoD,EAAA,GAARpD,QAAQ;AAAA,IAAAoD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}